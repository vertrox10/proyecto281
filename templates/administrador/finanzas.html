{% extends 'administrador/base.html' %}
{% block title %}Gestión de Finanzas{% endblock %}
{% block extra_head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root {
        --primary-color: #2c3e50;
        --secondary-color: #3498db;
        --success-color: #27ae60;
        --warning-color: #e67e22;
        --danger-color: #e74c3c;
        --light-color: #ecf0f1;
        --dark-color: #34495e;
        --info-color: #17a2b8;
    }
    
    .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .dashboard-header {
        background-color: var(--primary-color);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 25px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .logo-section {
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }
    
    .logo {
        height: 60px;
        width: auto;
        background: white;
        padding: 8px;
        border-radius: 8px;
    }
    
    .header-text h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
    }
    
    .header-text p {
        margin: 0.25rem 0 0 0;
        opacity: 0.9;
    }
    
    .logout-btn {
        background-color: rgba(255,255,255,0.1);
        color: white;
        text-decoration: none;
        padding: 10px 20px;
        border-radius: 5px;
        transition: background-color 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .logout-btn:hover {
        background-color: rgba(255,255,255,0.2);
    }
    
    .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }
    
    .form-section {
        width: 100%;
    }
    
    .section-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        height: fit-content;
    }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--light-color);
    }
    
    .section-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.5rem;
        color: var(--primary-color);
        margin: 0;
    }
    
    .section-badge {
        background-color: var(--secondary-color);
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: bold;
    }
    
    .modern-form {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .form-label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        color: var(--dark-color);
    }
    
    .form-select, .form-input {
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s, box-shadow 0.3s;
    }
    
    .form-select:focus, .form-input:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    
    .form-text {
        font-size: 0.85rem;
        color: #666;
        margin-top: 5px;
    }
    
    .info-empleado {
        background-color: rgba(52, 152, 219, 0.05);
        border: 1px solid rgba(52, 152, 219, 0.2);
        border-radius: 8px;
        padding: 15px;
        margin-top: 10px;
    }
    
    .empleado-details {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .detail-item {
        display: flex;
        justify-content: space-between;
    }
    
    .detail-label {
        font-weight: 500;
        color: var(--dark-color);
    }
    
    .detail-value {
        font-weight: 600;
        color: var(--secondary-color);
    }
    
    .btn-primary, .btn-success, .btn-info, .btn-secondary, .btn-outline {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
    }
    
    .btn-primary {
        background-color: var(--secondary-color);
        color: white;
    }
    
    .btn-primary:hover {
        background-color: #2980b9;
    }
    
    .btn-success {
        background-color: var(--success-color);
        color: white;
    }
    
    .btn-success:hover {
        background-color: #219653;
    }
    
    .btn-info {
        background-color: var(--info-color);
        color: white;
    }
    
    .btn-info:hover {
        background-color: #138496;
    }
    
    .btn-secondary {
        background-color: var(--warning-color);
        color: white;
    }
    
    .btn-secondary:hover {
        background-color: #d35400;
    }
    
    .btn-outline {
        background-color: transparent;
        color: var(--dark-color);
        border: 1px solid #ddd;
    }
    
    .btn-outline:hover {
        background-color: #f8f9fa;
    }
    
    .btn-large {
        padding: 15px 30px;
        font-size: 1.1rem;
    }
    
    .btn-small {
        padding: 8px 16px;
        font-size: 0.9rem;
    }
    
    .conceptos-grid {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .concepto-item {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 10px;
        align-items: center;
    }
    
    .concepto-input, .monto-input {
        width: 100%;
    }
    
    .btn-eliminar-concepto {
        background: none;
        border: none;
        color: var(--danger-color);
        cursor: pointer;
        padding: 8px;
        border-radius: 4px;
        transition: background-color 0.3s;
    }
    
    .btn-eliminar-concepto:hover {
        background-color: rgba(231, 76, 60, 0.1);
    }
    
    .form-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .mensaje-section {
        margin-top: 1.5rem;
    }
    
    .mensaje-title {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
        color: var(--dark-color);
    }
    
    .mensaje-textarea {
        width: 100%;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        resize: vertical;
        min-height: 150px;
    }
    
    .mensaje-textarea:focus {
        outline: none;
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    
    /* Notificaciones */
    .toast-notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 15px;
        max-width: 400px;
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
    }
    
    .toast-success {
        border-left: 4px solid var(--success-color);
    }
    
    .toast-error {
        border-left: 4px solid var(--danger-color);
    }
    
    .toast-warning {
        border-left: 4px solid var(--warning-color);
    }
    
    .toast-info {
        border-left: 4px solid var(--info-color);
    }
    
    .toast-content {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .toast-close {
        background: none;
        border: none;
        cursor: pointer;
        color: #666;
        font-size: 1.1rem;
    }
    
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @media (max-width: 1024px) {
        .main-grid {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 768px) {
        .dashboard-container {
            padding: 10px;
        }
        
        .header-content {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .concepto-item {
            grid-template-columns: 1fr;
        }
        
        .form-actions {
            flex-direction: column;
        }
        
        .section-card {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="logo-section">
                <img src="{{ url_for('static', filename='Logo.png') }}" alt="Logo" class="logo">
                <div class="header-text">
                    <h1>Gestión de Finanzas</h1>
                    <p>Sistema integral de pagos y cobranzas</p>
                </div>
            </div>
            <a href="{{ url_for('admin.logout') }}" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                Cerrar sesión
            </a>
        </div>
    </div>

    <div class="main-grid">
        <!-- Formulario de Pago a Empleados -->
        <div class="form-section">
            <div class="section-card">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-money-check-dollar"></i>
                        Pago a Empleados
                    </h2>
                    <div class="section-badge">Nómina</div>
                </div>
                
                <form method="POST" action="{{ url_for('admin.pagar_empleado') }}" class="modern-form">
                    <div class="form-group">
                        <label for="id_usuario" class="form-label">
                            <i class="fas fa-user-tie"></i>
                            Empleado
                        </label>
                        <select name="id_usuario" id="select-empleado" class="form-select" required onchange="actualizarInfoEmpleado()">
                            <option value="">Seleccione un empleado</option>
                            {% for empleado in empleados %}
                                <option value="{{ empleado.id_usuario }}" data-salario="{{ empleado.salario }}" data-banco="{{ empleado.banco }}" data-cuenta="{{ empleado.numero_cuenta }}">
                                    {{ empleado.nombre }} {{ empleado.ap_paterno }} - {{ empleado.puesto }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Información del empleado seleccionado -->
                    <div id="info-empleado" class="info-empleado" style="display: none;">
                        <div class="empleado-details">
                            <div class="detail-item">
                                <span class="detail-label">Salario Base:</span>
                                <span id="salario-base" class="detail-value">Bs 0.00</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Banco:</span>
                                <span id="banco-empleado" class="detail-value">No registrado</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Cuenta:</span>
                                <span id="cuenta-empleado" class="detail-value">No registrada</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="monto" class="form-label">
                            <i class="fas fa-coins"></i>
                            Monto (Bs)
                        </label>
                        <input type="number" name="monto" step="0.01" min="0" 
                               class="form-input" placeholder="0.00" id="input-monto">
                        <small class="form-text">Dejar vacío para usar salario base</small>
                    </div>

                    <div class="form-group">
                        <label for="metodo" class="form-label">
                            <i class="fas fa-credit-card"></i>
                            Método de Pago
                        </label>
                        <select name="metodo" id="metodo-pago" class="form-select" required onchange="mostrarCampoTransferencia()">
                            <option value="transferencia">💰 Transferencia</option>
                            <option value="efectivo">💵 Efectivo</option>
                            <option value="QR">📱 QR</option>
                        </select>
                    </div>

                    <!-- Campo condicional para transferencia -->
                    <div class="form-group" id="campo-nro-trans" style="display: none;">
                        <label for="nro_trans" class="form-label">
                            <i class="fas fa-receipt"></i>
                            Número de Transacción (Opcional)
                        </label>
                        <input type="text" name="nro_trans" class="form-input" placeholder="Ej: TRF-123456">
                        <small class="form-text">Para transferencia se usará automáticamente el número de cuenta del empleado</small>
                    </div>

                    <button type="submit" class="btn-primary btn-large">
                        <i class="fas fa-paper-plane"></i>
                        Registrar Pago
                    </button>
                </form>
            </div>
        </div>

        <!-- Formulario de Cobros a Residentes -->
        <div class="form-section">
            <div class="section-card">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-building"></i>
                        Cobros a Residentes
                    </h2>
                </div>

                <form method="POST" action="{{ url_for('admin.registrar_cobros') }}" id="form-cobros" class="modern-form">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user"></i>
                            Residente
                        </label>
                        <select name="id_usuario" id="select-residente" class="form-select" required>
                            <option value="">Seleccione un residente</option>
                            {% for residente in residentes %}
                            <option value="{{ residente.id_usuario }}">
                                {{ residente.nombre }} {{ residente.ap_paterno }} - Piso {{ residente.piso }}, Depto. {{ residente.nro_departamento }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-list"></i>
                            Conceptos de Cobro
                        </label>
                        <div id="conceptos-container" class="conceptos-grid">
                            <div class="concepto-item">
                                <input type="text" name="concepto[]" placeholder="Ej. Agua" 
                                       class="form-input concepto-input" required
                                       oninput="actualizarMensaje()">
                                <input type="number" step="0.01" name="monto[]" placeholder="0.00" 
                                       class="form-input monto-input" required
                                       oninput="actualizarMensaje()">
                                <button type="button" class="btn-eliminar-concepto" onclick="eliminarConcepto(this)" title="Eliminar concepto">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" onclick="agregarConcepto()" class="btn-secondary btn-small">
                            <i class="fas fa-plus"></i>
                            Agregar Concepto
                        </button>
                        <button type="button" onclick="eliminarUltimoConcepto()" class="btn-outline btn-small">
                            <i class="fas fa-trash"></i>
                            Eliminar Último
                        </button>
                    </div>

                    <div class="mensaje-section">
                        <h3 class="mensaje-title">
                            <i class="fas fa-envelope"></i>
                            Mensaje para el Residente
                        </h3>
                        <textarea id="mensaje-residente" rows="6" class="mensaje-textarea" readonly></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-success btn-large">
                            <i class="fas fa-save"></i>
                            Registrar Cobros
                        </button>
                        
                        <button type="button" onclick="registrarYEnviar()" class="btn-info btn-large">
                            <i class="fas fa-paper-plane"></i>
                            Registrar y Enviar Mensaje
                        </button>
                        
                        <a href="{{ url_for('admin.reporte_deudas') }}" class="btn-outline btn-large">
                            <i class="fas fa-chart-bar"></i>
                            Ver Reportes
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Función para actualizar la información del empleado seleccionado
    function actualizarInfoEmpleado() {
        const selectEmpleado = document.getElementById("select-empleado");
        const empleadoOption = selectEmpleado.options[selectEmpleado.selectedIndex];
        const infoEmpleado = document.getElementById("info-empleado");
        
        if (empleadoOption.value && empleadoOption.dataset.salario) {
            const salario = parseFloat(empleadoOption.dataset.salario);
            const banco = empleadoOption.dataset.banco || 'No registrado';
            const cuenta = empleadoOption.dataset.cuenta || 'No registrada';
            
            document.getElementById("salario-base").textContent = `Bs ${salario.toFixed(2)}`;
            document.getElementById("banco-empleado").textContent = banco;
            document.getElementById("cuenta-empleado").textContent = cuenta;
            document.getElementById("input-monto").value = salario.toFixed(2);
            infoEmpleado.style.display = 'block';
        } else {
            infoEmpleado.style.display = 'none';
            document.getElementById("input-monto").value = '';
        }
    }

    // Función para mostrar/ocultar campo de número de transacción
    function mostrarCampoTransferencia() {
        const metodoPago = document.getElementById("metodo-pago").value;
        const campoNroTrans = document.getElementById("campo-nro-trans");
        
        if (metodoPago === 'transferencia') {
            campoNroTrans.style.display = 'block';
        } else {
            campoNroTrans.style.display = 'none';
        }
    }

    // Funciones para gestión de conceptos de cobro
    function agregarConcepto() {
        const container = document.getElementById("conceptos-container");
        const nuevo = document.createElement("div");
        nuevo.className = "concepto-item";
        nuevo.innerHTML = `
            <input type="text" name="concepto[]" placeholder="Ej. Luz" 
                   class="form-input concepto-input" required
                   oninput="actualizarMensaje()">
            <input type="number" step="0.01" name="monto[]" placeholder="0.00" 
                   class="form-input monto-input" required
                   oninput="actualizarMensaje()">
            <button type="button" class="btn-eliminar-concepto" onclick="eliminarConcepto(this)" title="Eliminar concepto">
                <i class="fas fa-times"></i>
            </button>
        `;
        container.appendChild(nuevo);
        actualizarMensaje();
    }

    function eliminarConcepto(element) {
        const conceptoItem = element.closest('.concepto-item');
        const container = document.getElementById("conceptos-container");
        const items = container.getElementsByClassName('concepto-item');
        
        if (items.length > 1) {
            container.removeChild(conceptoItem);
            actualizarMensaje();
        } else {
            mostrarNotificacion('Debe haber al menos un concepto de cobro registrado.', 'warning');
        }
    }

    function eliminarUltimoConcepto() {
        const container = document.getElementById("conceptos-container");
        const items = container.getElementsByClassName('concepto-item');
        
        if (items.length > 1) {
            eliminarConcepto(items[items.length - 1].querySelector('.btn-eliminar-concepto'));
        } else {
            mostrarNotificacion('Debe haber al menos un concepto de cobro registrado.', 'warning');
        }
    }

    // Función para actualizar el mensaje automáticamente
    function actualizarMensaje() {
        const selectResidente = document.getElementById("select-residente");
        const nombreResidente = selectResidente.options[selectResidente.selectedIndex].text;
        const conceptos = document.querySelectorAll("input[name='concepto[]']");
        const montos = document.querySelectorAll("input[name='monto[]']");
        
        let total = 0;
        let conceptosValidos = [];
        
        // Procesar conceptos y montos
        for (let i = 0; i < conceptos.length; i++) {
            const concepto = conceptos[i].value.trim();
            const monto = parseFloat(montos[i].value);
            
            if (concepto && !isNaN(monto) && monto > 0) {
                conceptosValidos.push({ concepto, monto });
                total += monto;
            }
        }
        
        // Generar mensaje
        let mensaje = `Estimado/a ${nombreResidente},\n\n`;
        mensaje += `Se han registrado los siguientes cobros por servicios:\n\n`;
        
        if (conceptosValidos.length > 0) {
            conceptosValidos.forEach(item => {
                mensaje += `• ${item.concepto}: Bs ${item.monto.toFixed(2)}\n`;
            });
            
            mensaje += `\n💰 Total a pagar: Bs ${total.toFixed(2)}\n\n`;
            mensaje += `Fecha límite de pago: ${obtenerFechaLimite()}\n\n`;
            mensaje += `Métodos de pago disponibles:\n`;
            mensaje += `• Transferencia bancaria\n`;
            mensaje += `• Efectivo en administración\n`;
            mensaje += `• QR de pago\n\n`;
        } else {
            mensaje += `No se han registrado conceptos de cobro válidos.\n\n`;
        }
        
        mensaje += `Agradecemos su puntualidad en el pago.\n\n`;
        mensaje += `Atentamente,\n`;
        mensaje += `Administración del Edificio`;
        
        document.getElementById("mensaje-residente").value = mensaje;
    }

    function obtenerFechaLimite() {
        const hoy = new Date();
        const fechaLimite = new Date(hoy);
        fechaLimite.setDate(hoy.getDate() + 7);
        
        return fechaLimite.toLocaleDateString('es-ES', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
    }

    // Función para registrar y enviar mensaje
    function registrarYEnviar() {
        const formCobros = document.getElementById('form-cobros');
        const selectResidente = document.getElementById("select-residente");
        const idUsuario = selectResidente.value;
        const mensaje = document.getElementById("mensaje-residente").value.trim();
        
        // Validaciones
        if (!mensaje) {
            mostrarNotificacion('El mensaje está vacío. Por favor, agregue conceptos de cobro primero.', 'error');
            return false;
        }
        
        const conceptos = document.querySelectorAll("input[name='concepto[]']");
        let conceptosValidos = false;
        
        for (let i = 0; i < conceptos.length; i++) {
            const concepto = conceptos[i].value.trim();
            const monto = parseFloat(document.querySelectorAll("input[name='monto[]']")[i].value);
            
            if (concepto && !isNaN(monto) && monto > 0) {
                conceptosValidos = true;
                break;
            }
        }
        
        if (!conceptosValidos) {
            mostrarNotificacion('Debe agregar al menos un concepto de cobro válido antes de enviar.', 'warning');
            return false;
        }
        
        // Primero registrar los cobros
        mostrarNotificacion('Registrando cobros...', 'info');
        
        // Crear un formulario temporal para enviar el mensaje
        const formData = new FormData();
        formData.append('id_usuario', idUsuario);
        formData.append('mensaje', mensaje);
        
        // Enviar primero el formulario de cobros
        fetch(formCobros.action, {
            method: 'POST',
            body: new FormData(formCobros)
        })
        .then(response => {
            if (response.ok) {
                // Si los cobros se registran bien, enviar el mensaje
                return fetch("{{ url_for('admin.enviar_mensaje_residente') }}", {
                    method: 'POST',
                    body: formData
                });
            } else {
                throw new Error('Error al registrar cobros');
            }
        })
        .then(response => {
            if (response.ok) {
                mostrarNotificacion('✅ Cobros registrados y mensaje enviado correctamente', 'success');
                // Recargar después de 2 segundos
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } else {
                throw new Error('Error al enviar mensaje');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            mostrarNotificacion('❌ Error en el proceso: ' + error.message, 'error');
        });
    }

    // Función para mostrar notificaciones
    function mostrarNotificacion(mensaje, tipo = 'info') {
        // Buscar si ya existe una notificación
        const notificacionesExistentes = document.querySelectorAll('.toast-notification');
        notificacionesExistentes.forEach(notif => notif.remove());
        
        // Crear notificación
        const toast = document.createElement('div');
        toast.className = `toast-notification toast-${tipo}`;
        toast.innerHTML = `
            <div class="toast-content">
                <i class="fas ${obtenerIconoTipo(tipo)}"></i>
                <span>${mensaje}</span>
            </div>
            <button class="toast-close" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        document.body.appendChild(toast);
        
        // Auto-eliminar después de 5 segundos
        setTimeout(() => {
            if (toast.parentElement) {
                toast.remove();
            }
        }, 5000);
    }

    function obtenerIconoTipo(tipo) {
        const iconos = {
            'success': 'fa-check-circle',
            'error': 'fa-exclamation-circle',
            'warning': 'fa-exclamation-triangle',
            'info': 'fa-info-circle'
        };
        return iconos[tipo] || 'fa-info-circle';
    }

    // Inicialización
    document.addEventListener("DOMContentLoaded", function() {
        actualizarMensaje();
        
        const selectResidente = document.getElementById("select-residente");
        if (selectResidente) {
            selectResidente.addEventListener('change', actualizarMensaje);
        }
    });

    // Validación del formulario de cobros
    document.addEventListener('DOMContentLoaded', function() {
        const formCobros = document.getElementById('form-cobros');
        if (formCobros) {
            formCobros.addEventListener('submit', function(e) {
                const conceptos = document.querySelectorAll("input[name='concepto[]']");
                let conceptosValidos = false;
                
                for (let i = 0; i < conceptos.length; i++) {
                    const concepto = conceptos[i].value.trim();
                    const monto = parseFloat(document.querySelectorAll("input[name='monto[]']")[i].value);
                    
                    if (concepto && !isNaN(monto) && monto > 0) {
                        conceptosValidos = true;
                        break;
                    }
                }
                
                if (!conceptosValidos) {
                    e.preventDefault();
                    mostrarNotificacion('Debe agregar al menos un concepto de cobro válido antes de registrar.', 'warning');
                } else {
                    mostrarNotificacion('Registrando cobros...', 'info');
                }
            });
        }
    });
</script>
{% endblock %}