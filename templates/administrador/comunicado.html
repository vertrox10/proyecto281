{% extends 'administrador/base.html' %}
{% block title %}Enviar Comunicados{% endblock %}
{% block content %}
<div class="header" style="display: flex; align-items: center; gap: 18px;">
    <h1 style="margin:0;">📢 Enviar Comunicados</h1>
    <span style="margin-left:auto;"></span>
    <a href="{{ url_for('admin.logout') }}" class="logout-btn">Cerrar sesión</a>
</div>

<!-- Mensajes Flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'danger' else 'info' if category == 'info' else 'success' if category == 'success' else 'warning' }}" 
                 style="max-width: 800px; margin: 20px auto; padding: 15px; border-radius: 5px; 
                        background: {{ '#f8d7da' if category == 'danger' else '#d1ecf1' if category == 'info' else '#d4edda' if category == 'success' else '#fff3cd' }}; 
                        color: {{ '#721c24' if category == 'danger' else '#0c5460' if category == 'info' else '#155724' if category == 'success' else '#856404' }}; 
                        border: 1px solid {{ '#f5c6cb' if category == 'danger' else '#bee5eb' if category == 'info' else '#c3e6cb' if category == 'success' else '#ffeaa7' }};">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<!-- Formulario de Comunicado -->
<div style="max-width: 800px; margin: 20px auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <h2 style="color: #2c3e50; margin-bottom: 25px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
        Nuevo Comunicado por Email
    </h2>
    
    <form method="POST" action="{{ url_for('admin.comunicado') }}">
        <!-- Título -->
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">
                📝 Asunto del Comunicado: *
            </label>
            <input type="text" name="titulo" required 
                   style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px;"
                   placeholder="Ej: Mantenimiento programado, Corte de agua, Reunión importante...">
        </div>
        
        <!-- Mensaje -->
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">
                💬 Mensaje: *
            </label>
            <textarea name="mensaje" required rows="8"
                      style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; resize: vertical;"
                      placeholder="Escribe aquí el contenido detallado del comunicado..."></textarea>
        </div>
        
        <!-- Destinatarios -->
        <div style="margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 5px;">
            <label style="display: block; margin-bottom: 15px; font-weight: bold; color: #333;">
                👥 Destinatarios: *
            </label>
            <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" name="destinatarios" value="residentes" checked 
                           style="transform: scale(1.3);">
                    <span style="font-size: 16px;">👨‍👩‍👧‍👦 Residentes</span>
                </label>
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" name="destinatarios" value="empleados" checked 
                           style="transform: scale(1.3);">
                    <span style="font-size: 16px;">👷 Empleados</span>
                </label>
            </div>
            <p style="margin-top: 10px; font-size: 14px; color: #666;">
                * El comunicado se enviará a todos los emails registrados en la base de datos
            </p>
        </div>
        
        <!-- Botón -->
        <button type="submit" 
                style="background: #4caf50; color: white; padding: 15px 40px; border: none; border-radius: 5px; 
                       cursor: pointer; font-size: 16px; font-weight: bold; display: block; margin: 0 auto;">
            📧 Enviar Comunicado
        </button>
    </form>
</div>

<!-- Información -->
<div style="max-width: 800px; margin: 30px auto; padding: 20px; background: #e3f2fd; border-radius: 5px;">
    <h3 style="color: #1565c0; margin-bottom: 15px;">💡 Información Importante</h3>
    <ul style="color: #333; line-height: 1.6;">
        <li>El comunicado se enviará <strong>inmediatamente</strong> por email a todos los destinatarios seleccionados</li>
        <li><strong>Residentes:</strong> Todos los residentes activos con email registrado en el sistema</li>
        <li><strong>Empleados:</strong> Todo el personal activo con email registrado en el sistema</li>
        <li>Los emails se obtienen directamente de la base de datos del edificio</li>
        <li>Revisa el contenido antes de enviar, ya que no se puede cancelar</li>
    </ul>
</div>

<style>
.logout-btn {
    background: #f44336;
    color: white;
    padding: 10px 20px;
    text-decoration: none;
    border-radius: 5px;
    font-weight: bold;
}

input:focus, textarea:focus {
    outline: none;
    border-color: #4caf50 !important;
    box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
}

.alert {
    transition: opacity 0.3s ease;
}
</style>
{% endblock %}