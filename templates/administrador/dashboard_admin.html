{% extends 'administrador/base.html' %}

{% block title %}Dashboard Administrativo{% endblock %}

{% block content %}
<div class="header" style="display: flex; align-items: center; gap: 18px; margin-bottom: 2rem;">
    <img src="{{ url_for('static', filename='Logo P.png') }}" alt="Logo" class="logo-dashboard"
        style="height:100px;width:auto;display:block;">
    <h1 style="margin:0;">Dashboard Administrativo</h1>
    <a href="{{ url_for('admin.logout') }}" class="logout-btn" style="margin-left:auto;">Cerrar sesión</a>
</div>

<div class="cards">
    <div class="overview">
        <div class="card">
            <i class="fas fa-coins"></i>
            <h3>Ingresos Totales</h3>
            <p>$0.00</p>
        </div>
        <div class="card">
            <i class="fas fa-bolt"></i>
            <h3>Consumo Total</h3>
            <p>{{ "%.2f"|format(consumo_total) }} kWh</p>

        </div>
        <div class="card">
            <i class="fas fa-calendar-alt"></i>
            <h3>Reservas</h3>
            <p>0</p>
        </div>
        <div class="card">
            <i class="fas fa-ticket-alt"></i>
            <h3>Tickets</h3>
            <p>0</p>
        </div>
    </div>
</div>

<div class="chart">
    <h2>Gráfico de Actividad</h2>
    <canvas id="lineChart"></canvas>
</div>

<div class="invitaciones">
    <h2>Generar nuevo código de invitación</h2>
    <form action="{{ url_for('admin.generar_invitacion') }}" method="POST">
        <label for="rol_destino">Rol destino:</label>
        <select name="rol_destino" id="rol_destino" required>
            <option value="empleado">Empleado</option>
            <option value="admin">Administrador</option>
        </select>
        <button type="submit">Generar código</button>
    </form>
</div>

<div class="correo-invitacion-container">
    <h2>Enviar invitación por correo (solo empleados)</h2>
    <div id="progress-bar" style="display:none;position:fixed;top:0;left:0;width:100vw;height:4px;z-index:9999;">
        <div id="progress-bar-inner" style="height:100%;width:0;background:#1976d2;transition:width 0.4s;"></div>
    </div>
    <form id="correo-form" class="correo-invitacion-form" action="{{ url_for('admin.enviar_invitacion') }}"
        method="POST">
        <label for="correo">Correo del empleado:</label>
        <input type="email" name="correo" required>
        <button type="submit">Enviar invitación</button>
    </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('lineChart').getContext('2d');
    const lineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
            datasets: [
                {
                    label: 'Ingresos',
                    data: [1200, 1500, 1100, 1800, 1700, 2000],
                    borderColor: 'orange',
                    fill: false
                },
                {
                    label: 'Consumo',
                    data: [300, 280, 350, 400, 370, 390],
                    borderColor: 'blue',
                    fill: false
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' }
            }
        }
    });
</script>
<script>
    // Barra de progreso tipo Gmail al enviar invitación
    const form = document.getElementById('correo-form');
    const bar = document.getElementById('progress-bar');
    const barInner = document.getElementById('progress-bar-inner');

    if (form && bar && barInner) {
        form.addEventListener('submit', function () {
            bar.style.display = 'block';
            barInner.style.width = '0';
            setTimeout(() => { barInner.style.width = '80%'; }, 100);
        });

        window.addEventListener('pageshow', function () {
            bar.style.display = 'none';
            barInner.style.width = '0';
        });
    }
</script>
{% endblock %}