{% extends "residente/base_residente.html" %}

{% block title %}Mis Reservas - SincroHome{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='residente/reservas.css') }}">
{% endblock %}

{% block content %}
<div class="reservas-header">
    <h1>Mis Reservas</h1>
    <p>Gestiona tus reservas de áreas comunes</p>
</div>

<!-- Alerta de Políticas -->
<div class="politicas-alert">
    <div class="alert-icon">
        <i class="fas fa-exclamation-circle"></i>
    </div>
    <div class="alert-content">
        <h4>Importante: Políticas del Edificio</h4>
        <p>Antes de realizar cualquier reserva, por favor lee y comprende nuestras
            <a href="{{ url_for('residentes.politicas') }}">políticas y reglas</a>
            para el uso de áreas comunes.
        </p>
    </div>
</div>

<!-- Horarios Disponibles -->
<div class="horarios-section">
    <h3>Horarios de Áreas Comunes</h3>
    <div class="horarios-grid">
        <div class="horario-card">
            <i class="fas fa-clock"></i>
            <h4>Salón de Eventos</h4>
            <p>Lunes a Domingo: 8:00 - 22:00</p>
        </div>
        <div class="horario-card">
            <i class="fas fa-clock"></i>
            <h4>Piscina</h4>
            <p>Martes a Domingo: 9:00 - 19:00</p>
        </div>
        <div class="horario-card">
            <i class="fas fa-clock"></i>
            <h4>Gimnasio</h4>
            <p>Lunes a Sábado: 6:00 - 22:00</p>
        </div>
        <div class="horario-card">
            <i class="fas fa-clock"></i>
            <h4>Parqueo</h4>
            <p>Todos los días: 24 horas</p>
        </div>
    </div>
</div>

<!-- Áreas Disponibles -->
<div class="areas-grid">
    <!-- Salón de Eventos -->
    <div class="area-card">
        <div class="area-icon">
            <i class="fas fa-glass-cheers"></i>
        </div>
        <div class="area-info">
            <h3>Salón de Eventos</h3>
            <p>Capacidad: 50 personas. Ideal para celebraciones y reuniones.</p>
            <div class="area-details">
                <div class="detail-item">
                    <i class="fas fa-clock"></i>
                    <span>Lun-Dom: 8:00-22:00</span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-users"></i>
                    <span>Máx. 50 personas</span>
                </div>
            </div>
            <div class="area-status">
                <span class="status-badge available">Disponible</span>
                <span class="price">350 Bs</span>
            </div>
        </div>
        <button class="btn-reservar" onclick="abrirModalReserva('salon', 'Salón de Eventos', 350.00)">
            <i class="fas fa-calendar-plus"></i> Reservar
        </button>
    </div>

    <!-- Piscina -->
    <div class="area-card">
        <div class="area-icon">
            <i class="fas fa-swimming-pool"></i>
        </div>
        <div class="area-info">
            <h3>Piscina</h3>
            <p>Área recreativa con capacidad para 30 personas simultáneamente.</p>
            <div class="area-details">
                <div class="detail-item">
                    <i class="fas fa-clock"></i>
                    <span>Mar-Dom: 9:00-19:00</span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-users"></i>
                    <span>Máx. 30 personas</span>
                </div>
            </div>
            <div class="area-status">
                <span class="status-badge available">Disponible</span>
                <span class="price">200 Bs</span>
            </div>
        </div>
        <button class="btn-reservar" onclick="abrirModalReserva('piscina', 'Piscina', 200.00)">
            <i class="fas fa-calendar-plus"></i> Reservar
        </button>
    </div>

    <!-- Gimnasio -->
    <div class="area-card">
        <div class="area-icon">
            <i class="fas fa-dumbbell"></i>
        </div>
        <div class="area-info">
            <h3>Gimnasio SincroHome</h3>
            <p>Equipo completo de ejercicio. Uso por horas.</p>
            <div class="area-details">
                <div class="detail-item">
                    <i class="fas fa-clock"></i>
                    <span>Lun-Sáb: 6:00-22:00</span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-users"></i>
                    <span>Máx. 15 personas</span>
                </div>
            </div>
            <div class="area-status">
                <span class="status-badge available">Disponible</span>
                <span class="price">25 Bs/hora</span>
            </div>
        </div>
        <button class="btn-reservar" onclick="abrirModalReserva('gimnasio', 'Gimnasio SincroHome', 25.00)">
            <i class="fas fa-calendar-plus"></i> Reservar
        </button>
    </div>

    <!-- Parqueo -->
    <div class="area-card">
        <div class="area-icon">
            <i class="fas fa-parking"></i>
        </div>
        <div class="area-info">
            <h3>Parqueo de Visitantes</h3>
            <p>Espacios adicionales para visitantes del residente.</p>
            <div class="area-details">
                <div class="detail-item">
                    <i class="fas fa-clock"></i>
                    <span>Todos los días: 24h</span>
                </div>
                <div class="detail-item">
                    <i class="fas fa-car"></i>
                    <span>1 vehículo por reserva</span>
                </div>
            </div>
            <div class="area-status">
                <span class="status-badge available">Disponible</span>
                <span class="price">10 Bs/día</span>
            </div>
        </div>
        <button class="btn-reservar" onclick="abrirModalReserva('parqueo', 'Parqueo de Visitantes', 10.00)">
            <i class="fas fa-calendar-plus"></i> Reservar
        </button>
    </div>
</div>


<!-- Mis Reservas Activas -->
<div class="reservas-activas">
    <div class="section-header">
        <h2>Mis Reservas Activas</h2>
        <button class="btn-exportar" onclick="exportarReservasPDF()">
            <i class="fas fa-file-pdf"></i> Exportar PDF
        </button>
    </div>
    <div class="reservas-list" id="listaReservas">
        <div class="no-reservas">
            <i class="fas fa-calendar-times"></i>
            <p>No tienes reservas activas</p>
        </div>
    </div>
</div>

<!-- Modal de Reserva -->
<div id="modalReserva" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitulo">Reservar Área</h3>
            <span class="close" onclick="cerrarModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="reserva-info-preview">
                <h4 id="previewArea"></h4>
                <p id="previewPrecio"></p>
                <p id="previewHorario" style="font-size: 0.9rem; color: #666;"></p>
            </div>

            <div class="calendario-container">
                <h4>Selecciona una fecha:</h4>
                <input type="date" id="fechaReserva" min="{{ hoy }}" onchange="validarFecha()">
                <small id="mensajeFecha" style="color: #666; display: block; margin-top: 5px;"></small>
            </div>

            <!-- Para Gimnasio: Selección de horas -->
            <div id="horasGimnasio" style="display: none; margin-bottom: 20px;">
                <h4>Selecciona las horas:</h4>
                <select id="horasSeleccion" onchange="calcularMontoGimnasio()">
                    <option value="1">1 hora</option>
                    <option value="2">2 horas</option>
                    <option value="3">3 horas</option>
                    <option value="4">4 horas</option>
                </select>
                <p id="montoGimnasio" style="margin-top: 10px; font-weight: bold; color: var(--verde-oliva);"></p>
            </div>

            <div class="modal-actions">
                <button class="btn-cancelar" onclick="cerrarModal()">Cancelar</button>
                <button class="btn-continuar" onclick="mostrarFormularioPago()" id="btnContinuar" disabled>
                    Continuar con el Pago
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Pago QR -->
<div id="modalPagoQR" class="modal">
    <div class="modal-content pago-modal">
        <div class="modal-header">
            <h3>Pago con Código QR</h3>
            <span class="close" onclick="cerrarModalPagoQR()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="detalle-pago">
                <h4>Detalle del Pago</h4>
                <div class="pago-item">
                    <span>Área:</span>
                    <span id="pagoArea"></span>
                </div>
                <div class="pago-item">
                    <span>Fecha:</span>
                    <span id="pagoFecha"></span>
                </div>
                <div class="pago-item">
                    <span>Monto:</span>
                    <span id="pagoMonto" style="font-weight: bold; color: var(--verde-oliva);"></span>
                </div>
            </div>

            <div class="qr-section">
                <h4>Escanea el Código QR</h4>
                <div id="codigoQR">
                    <img src="{{ url_for('static', filename='images/qr_pago.jpg') }}" alt="Código QR para pago"
                        style="max-width: 250px; border: 2px solid #ddd; border-radius: 8px;">
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        <strong>Banco:</strong> Banco SincroHome<br>
                        <strong>Cuenta:</strong> 1234-5678-9012<br>
                        <strong>Concepto:</strong> Reserva Área Común
                    </p>
                </div>
                <p class="qr-instructions">
                    <i class="fas fa-info-circle"></i>
                    Escanea este código QR con tu aplicación de banca móvil para realizar el pago.
                </p>
            </div>

            <!-- Subir Boucher -->
            <div class="boucher-section">
                <h4>Subir Comprobante de Pago</h4>
                <div class="form-group">
                    <label for="boucherFile">Selecciona el comprobante (PDF, JPG, PNG):</label>
                    <input type="file" id="boucherFile" name="boucher" accept=".pdf,.jpg,.jpeg,.png"
                        onchange="previewBoucher(this)">
                </div>
                <div id="boucherPreview" style="display: none; margin-top: 10px;">
                    <p style="color: green; font-weight: bold;">
                        <i class="fas fa-check-circle"></i> Archivo seleccionado
                    </p>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn-cancelar" onclick="cerrarModalPagoQR()">Cancelar</button>
                <button type="button" class="btn-confirmar" onclick="confirmarPagoRealizado()" id="btnConfirmarQR">
                    <i class="fas fa-check-circle"></i> Confirmar Pago y Subir Comprobante
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Facturación Manual -->
<div id="modalFacturacion" class="modal">
    <div class="modal-content factura-modal">
        <div class="modal-header">
            <h3>Facturación Manual</h3>
            <span class="close" onclick="cerrarModalFacturacion()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="formFacturacion">
                <div class="form-section">
                    <h4>Datos del Residente</h4>
                    <div class="form-group">
                        <label for="facturaCI">Cédula de Identidad:</label>
                        <input type="text" id="facturaCI" name="ci" required>
                    </div>
                    <div class="form-group">
                        <label for="facturaNombre">Nombre Completo:</label>
                        <input type="text" id="facturaNombre" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="facturaDepartamento">Departamento:</label>
                        <input type="text" id="facturaDepartamento" name="departamento" required>
                    </div>
                </div>

                <div class="form-section">
                    <h4>Detalles del Pago</h4>
                    <div class="form-group">
                        <label for="facturaArea">Área Reservada:</label>
                        <input type="text" id="facturaArea" name="area" readonly>
                    </div>
                    <div class="form-group">
                        <label for="facturaFecha">Fecha de Reserva:</label>
                        <input type="text" id="facturaFecha" name="fecha" readonly>
                    </div>
                    <div class="form-group">
                        <label for="facturaMonto">Monto Pagado:</label>
                        <input type="text" id="facturaMonto" name="monto" readonly>
                    </div>
                    <div class="form-group">
                        <label for="facturaMetodo">Método de Pago:</label>
                        <select id="facturaMetodo" name="metodo" required>
                            <option value="">Seleccione método</option>
                            <option value="efectivo">Efectivo</option>
                            <option value="transferencia">Transferencia Bancaria</option>
                            <option value="tarjeta">Tarjeta de Crédito/Débito</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="facturaComprobante">Número de Comprobante:</label>
                        <input type="text" id="facturaComprobante" name="comprobante" required
                            placeholder="Ingrese el número de comprobante">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-cancelar" onclick="cerrarModalFacturacion()">Cancelar</button>
                    <button type="submit" class="btn-confirmar">
                        <i class="fas fa-file-invoice"></i> Generar Factura
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal de Factura Generada -->
<div id="modalFactura" class="modal">
    <div class="modal-content factura-modal" style="max-width: 600px;">
        <div class="modal-header">
            <h3>Factura Generada</h3>
            <span class="close" onclick="cerrarModalFactura()">&times;</span>
        </div>
        <div class="modal-body">
            <div id="facturaContent"
                style="background: white; padding: 20px; border-radius: 8px; border: 2px solid #ddd;">
                <!-- Contenido de la factura se generará aquí -->
            </div>
            <div class="form-actions" style="margin-top: 20px;">
                <button type="button" class="btn-cancelar" onclick="cerrarModalFactura()">Cerrar</button>
                <button type="button" class="btn-confirmar" onclick="imprimirFactura()">
                    <i class="fas fa-print"></i> Imprimir Factura
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}

<script src="{{ url_for('static', filename='residente/reservas.js') }}"></script>
{% endblock %}