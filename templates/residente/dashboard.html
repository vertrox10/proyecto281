{% extends "residente/base_residente.html" %}

{% block title %}Dashboard Residente{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='residente/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Dashboard Residente</h1>
    <p>Bienvenido de vuelta, {{ current_user.nombre }}</p>
</div>

<div class="metrics-grid">
    <!-- Estado de Pagos -->
    <div class="metric-card payment-status">
        <div class="metric-icon">
            <i class="fas fa-money-bill-wave"></i>
        </div>
        <div class="metric-info">
            <h3>Estado de Pagos</h3>
            <div class="metric-value">{{ estado_pagos.estado }}</div>
            <div class="metric-detail">
                <span class="amount">${{ estado_pagos.monto_pendiente }}</span>
                <span class="date">Vence: {{ estado_pagos.fecha_vencimiento }}</span>
            </div>
        </div>
    </div>

    <!-- Consumo Actual -->
    <div class="metric-card consumption">
        <div class="metric-icon">
            <i class="fas fa-bolt"></i>
        </div>
        <div class="metric-info">
            <h3>Consumo Este Mes</h3>
            <div class="consumption-details">
                <div class="consumption-item">
                    <span>Luz:</span>
                    <strong>{{ consumos.luz }} kWh</strong>
                </div>
                <div class="consumption-item">
                    <span>Agua:</span>
                    <strong>{{ consumos.agua }} m³</strong>
                </div>
                <div class="consumption-item">
                    <span>Gas:</span>
                    <strong>{{ consumos.gas }} m³</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- Solicitudes Activas -->
    <div class="metric-card tickets">
        <div class="metric-icon">
            <i class="fas fa-ticket-alt"></i>
        </div>
        <div class="metric-info">
            <h3>Solicitudes Activas</h3>
            <div class="metric-value">{{ solicitudes_activas }}</div>
            <div class="metric-detail">
                <span class="priority-high">{{ solicitudes_prioridad_alta }} alta prioridad</span>
            </div>
        </div>
    </div>

    <!-- Próximo Mantenimiento -->
    <div class="metric-card maintenance">
        <div class="metric-icon">
            <i class="fas fa-tools"></i>
        </div>
        <div class="metric-info">
            <h3>Próximo Mantenimiento</h3>
            {% if proximo_mantenimiento %}
            <div class="metric-value">{{ proximo_mantenimiento.fecha }}</div>
            <div class="metric-detail">
                <span>{{ proximo_mantenimiento.descripcion }}</span>
            </div>
            {% else %}
            <div class="metric-value">No programado</div>
            {% endif %}
        </div>
    </div>
</div>

<div class="charts-grid">
    <!-- Gráfico de Consumos -->
    <div class="chart-card">
        <div class="card-header">
            <h3>Consumos Mensuales</h3>
            <select id="consumoPeriodo" class="form-control">
                <option value="3">Últimos 3 meses</option>
                <option value="6">Últimos 6 meses</option>
                <option value="12">Último año</option>
            </select>
        </div>
        <div class="chart-container">
            <canvas id="consumoChart"></canvas>
        </div>
    </div>

    <!-- Historial de Pagos -->
    <div class="chart-card">
        <div class="card-header">
            <h3>Historial de Pagos</h3>
        </div>
        <div class="chart-container">
            <canvas id="pagosChart"></canvas>
        </div>
    </div>
</div>

<div class="recent-activity">
    <div class="card">
        <div class="card-header">
            <h3>Actividad Reciente</h3>
        </div>
        <div class="activity-list">
            {% for actividad in actividades_recientes %}
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas {{ actividad.icono }}"></i>
                </div>
                <div class="activity-content">
                    <p class="activity-text">{{ actividad.descripcion }}</p>
                    <span class="activity-time">{{ actividad.fecha }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='residente/dashboard.js') }}"></script>
{% endblock %}